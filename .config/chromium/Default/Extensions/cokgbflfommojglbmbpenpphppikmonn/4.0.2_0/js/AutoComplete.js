var AutoComplete=new Class({Implements:Options,options:{size:10,render:function(a){return new Element("span",{text:a})}},initialize:function(a){this.setOptions(a);document.getElements("input[list]").each(function(c){var d=document.id(c.get("list")).getElements("option");var b=d.get("value");var g=d.get("text");var e=[];b.each(function(i,h){e.push(new Element("div",{"data-value":i,text:g[h]}))});var f=new Element("div",{"class":"autocomplete","for":c.get("name"),"data-current":0,styles:{display:"none",width:c.getWidth()-2},events:{"click:relay(div)":function(i){i.stopPropagation();var j=this.getParent().hide();j.dataset.current=-1;var h=j.getPrevious("[name={0}]".substitute([j.get("for")]));h.set("value",this.dataset.value)}}});f.adopt(e).inject(c,"after");f.position({relativeTo:c,position:"bottomLeft",edge:"upperLeft"})});document.getElements("input[list]").addEvents({focus:function(b){var c=this.getNext("[for={0}]".substitute([this.get("name")])).show().scrollTo(0,0);c.position({relativeTo:this,position:"bottomLeft",edge:"upperLeft"});c.dataset.current=-1;c.getElements("div").hide().removeClass("enabled").removeClass("active");if(this.get("value").length>0){c.getElements('div[data-value*="{0}"]'.substitute([this.get("value")])).show().addClass("enabled")}else{c.getElements("div").show().addClass("enabled")}},click:function(b){b.stopPropagation()},keyup:function(b){if(!["down","up","left","right","esc","enter"].contains(b.key)){this.fireEvent("focus",b)}},"keydown:keys(down)":function(e){e.stop();var f=this.getNext("[for={0}]".substitute([this.get("name")]));if(!f.isDisplayed()){this.fireEvent("focus",e)}else{f.show()}var b=f.getElements("div.enabled");if(b.length==0){b=f.getElements("div").show()}var g=Number(f.dataset.current);if(g+1<b.length){var d=g+1;var c=b[d].getSize(f);var h=b[d].getCoordinates(f);f.dataset.current=d;if(b[g]){b[g].removeClass("active")}b[d].addClass("active");if(h.bottom>=f.getSize().y){f.scrollTo(0,f.getScroll().y+c.y)}}},"keydown:keys(up)":function(e){e.stop();var f=this.getNext("[for={0}]".substitute([this.get("name")]));if(!f.isDisplayed()){this.fireEvent("focus",e)}else{f.show()}var b=f.getElements("div.enabled");if(b.length==0){b=f.getElements("div").show()}var g=Number(f.dataset.current);if(g-1>=0){var d=g-1;var c=b[d].getSize(f);var h=b[d].getCoordinates(f);f.dataset.current=d;b[g].removeClass("active");b[d].addClass("active");if(h.top<=0){f.scrollTo(0,f.getScroll().y-c.y)}}},"keydown:keys(esc)":function(b){document.getElements(".autocomplete").hide()},"keydown:keys(enter)":function(c){var d=this.getNext("[for={0}]".substitute([this.get("name")]));if(d.isDisplayed()){c.stop();var b=d.getElements("div.enabled");if(b.length==0){b=d.getElements("div")}if(d.dataset.current>-1){this.set("value",b[d.dataset.current].dataset.value);d.dataset.current=-1}d.hide()}}});document.body.addEvent("click",function(b){document.getElements(".autocomplete").hide()})}});