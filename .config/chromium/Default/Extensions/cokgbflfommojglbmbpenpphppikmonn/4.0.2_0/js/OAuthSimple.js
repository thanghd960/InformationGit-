var OAuthSimple;if(OAuthSimple===undefined){OAuthSimple=function(b,c){var a={};a._secrets={};if(b!==undefined){a._secrets.consumer_key=b}if(c!==undefined){a._secrets.shared_secret=c}a._default_signature_method="HMAC-SHA1";a._action="GET";a._nonce_chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";a._parameters={};a.reset=function(){this._parameters={};this._path=undefined;this.sbs=undefined;return this};a.setParameters=function(d){if(d===undefined){d={}}if(typeof(d)=="string"){d=this._parseParameterString(d)}this._parameters=this._merge(d,this._parameters);if(this._parameters.oauth_nonce===undefined){this._getNonce()}if(this._parameters.oauth_timestamp===undefined){this._getTimestamp()}if(this._parameters.oauth_signature_method===undefined){this.setSignatureMethod()}if(this._parameters.oauth_consumer_key===undefined){this._getApiKey()}if(this._parameters.oauth_token===undefined){this._getAccessToken()}if(this._parameters.oauth_version===undefined){this._parameters.oauth_version=="1.0"}return this};a.setQueryString=function(d){return this.setParameters(d)};a.setURL=function(d){if(d==""){throw ("No path specified for OAuthSimple.setURL")}this._path=d;return this};a.setPath=function(d){return this.setURL(d)};a.setAction=function(d){if(d===undefined){d="GET"}d=d.toUpperCase();if(d.match("[^A-Z]")){throw ("Invalid action specified for OAuthSimple.setAction")}this._action=d;return this};a.signatures=function(d){if(d){this._secrets=this._merge(d,this._secrets)}if(this._secrets.api_key){this._secrets.consumer_key=this._secrets.api_key}if(this._secrets.access_token){this._secrets.oauth_token=this._secrets.access_token}if(this._secrets.access_secret){this._secrets.oauth_secret=this._secrets.access_secret}if(this._secrets.oauth_token_secret){this._secrets.oauth_secret=this._secrets.oauth_token_secret}if(this._secrets.consumer_key===undefined){throw ("Missing required consumer_key in OAuthSimple.signatures")}if(this._secrets.shared_secret===undefined){throw ("Missing required shared_secret in OAuthSimple.signatures")}if((this._secrets.oauth_token!==undefined)&&(this._secrets.oauth_secret===undefined)){throw ("Missing oauth_secret for supplied oauth_token in OAuthSimple.signatures")}return this};a.setTokensAndSecrets=function(d){return this.signatures(d)};a.setSignatureMethod=function(d){if(d===undefined){d=this._default_signature_method}if(d.toUpperCase().match(/(PLAINTEXT|HMAC-SHA1)/)===undefined){throw ("Unknown signing method specified for OAuthSimple.setSignatureMethod")}this._parameters.oauth_signature_method=d.toUpperCase();return this};a.sign=function(e,f){if(e===undefined){e={}}if(e.action!==undefined){this.setAction(e.action)}if(e.path!==undefined){this.setPath(e.path)}if(e.method!==undefined){this.setSignatureMethod(e.method)}this.signatures(e.signatures);this.setParameters(e.parameters);var d=this._normalizedParameters();this._parameters.oauth_signature=this._generateSignature(d);return{parameters:this._parameters,signature:this._oauthEscape(this._parameters.oauth_signature),signed_url:this._path+"?"+this._normalizedParameters(),header:this.getHeaderString(e,f)}};a.getHeaderString=function(i,k){if(this._parameters.oauth_signature===undefined){this.sign(i)}var h=k||" ";var g,e,f;var d=[];for(e in this._parameters){if(e.match(/^oauth/)===undefined){continue}if((this._parameters[e]) instanceof Array){f=this._parameters[e].length;for(g=0;g<f;g++){d.push(e+'="'+this._oauthEscape(this._parameters[e][g])+'"')}}else{d.push(e+'="'+this._oauthEscape(this._parameters[e])+'"')}}return"OAuth "+d.join(h)};a._parseParameterString=function(i){var h=i.split("&"),d={},e;for(e=h.shift();e;e=h.shift()){var f=e.split("="),g="";if(f[1]){g=decodeURIComponent(f[1])}if(d[f[0]]){if(!(d[f[0]] instanceof Array)){d[f[0]]=Array(d[f[0]],g)}else{d[f[0]].push(g)}}else{d[f[0]]=g}}return d};a._oauthEscape=function(d){if(d===undefined){return""}if(d instanceof Array){throw ("Array passed to _oauthEscape")}return encodeURIComponent(d).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")};a._getNonce=function(g){if(g===undefined){g=5}var d="",f=0,e,h=this._nonce_chars.length;for(;f<g;f++){e=Math.floor(Math.random()*h);d+=this._nonce_chars.substring(e,e+1)}return this._parameters.oauth_nonce=d};a._getApiKey=function(){if(this._secrets.consumer_key===undefined){throw ("No consumer_key set for OAuthSimple.")}return this._parameters.oauth_consumer_key=this._secrets.consumer_key};a._getAccessToken=function(){if(this._secrets.oauth_secret===undefined){return""}if(this._secrets.oauth_token===undefined){throw ("No oauth_token (access_token) set for OAuthSimple.")}return this._parameters.oauth_token=this._secrets.oauth_token};a._getTimestamp=function(){var d=Math.floor((new Date()).getTime()/1000);return this._parameters.oauth_timestamp=d};a.b64_hmac_sha1=function(h,m,e,n){if(!e){e="="}if(!n){n=8}function j(s,k,v,u){if(s<20){return(k&v)|((~k)&u)}if(s<40){return k^v^u}if(s<60){return(k&v)|(k&u)|(v&u)}return k^v^u}function g(d){return(d<20)?1518500249:(d<40)?1859775393:(d<60)?-1894007588:-899497514}function q(k,t){var s=(k&65535)+(t&65535),d=(k>>16)+(t>>16)+(s>>16);return(d<<16)|(s&65535)}function r(k,d){return(k<<d)|(k>>>(32-d))}function l(H,z){H[z>>5]|=128<<(24-z%32);H[((z+64>>9)<<4)+15]=z;var I=[80],G=1732584193,F=-271733879,E=-1732584194,D=271733878,C=-1009589776;for(var B=0;B<H.length;B+=16){var y=G,v=F,u=E,k=D,K=C;for(var A=0;A<80;A++){if(A<16){I[A]=H[B+A]}else{I[A]=r(I[A-3]^I[A-8]^I[A-14]^I[A-16],1)}var J=q(q(r(G,5),j(A,F,E,D)),q(q(C,I[A]),g(A)));C=D;D=E;E=r(F,30);F=G;G=J}G=q(G,y);F=q(F,v);E=q(E,u);D=q(D,k);C=q(C,K)}return[G,F,E,D,C]}function o(u){var k=[],d=(1<<n)-1;for(var t=0;t<u.length*n;t+=n){k[t>>5]|=(u.charCodeAt(t/8)&d)<<(32-n-t%32)}return k}function i(t,y){var s=o(t);if(s.length>16){s=l(s,t.length*n)}var w=[16],x=[16];for(var u=0;u<16;u++){w[u]=s[u]^909522486;x[u]=s[u]^1549556828}var v=l(w.concat(o(y)),512+y.length*n);return l(x.concat(v),512+160)}function f(d){var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w="";for(var u=0;u<d.length*4;u+=3){var x=(((d[u>>2]>>8*(3-u%4))&255)<<16)|(((d[u+1>>2]>>8*(3-(u+1)%4))&255)<<8)|((d[u+2>>2]>>8*(3-(u+2)%4))&255);for(var k=0;k<4;k++){if(u*8+k*6>d.length*32){w+=e}else{w+=v.charAt((x>>6*(3-k))&63)}}}return w}function p(s,t){return f(i(s,t))}return p(h,m)};a._normalizedParameters=function(){var g=new Array(),m=[],f=0,l=0;for(var h in this._parameters){if(l++>1000){throw ("runaway 1")}m.unshift(h)}m=m.sort();pLen=m.length;for(;f<pLen;f++){h=m[f];if(h.match(/\w+_secret/)){continue}if(this._parameters[h] instanceof Array){var d=this._parameters[h].sort(),k=d.length,e=0;for(;e<k;e++){if(l++>1000){throw ("runaway 1")}g.push(this._oauthEscape(h)+"="+this._oauthEscape(d[e]))}continue}g.push(this._oauthEscape(h)+"="+this._oauthEscape(this._parameters[h]))}return g.join("&")};a._generateSignature=function(){var d=this._oauthEscape(this._secrets.shared_secret)+"&"+this._oauthEscape(this._secrets.oauth_secret);if(this._parameters.oauth_signature_method=="PLAINTEXT"){return d}if(this._parameters.oauth_signature_method=="HMAC-SHA1"){var e=this._oauthEscape(this._action)+"&"+this._oauthEscape(this._path)+"&"+this._oauthEscape(this._normalizedParameters());return this.b64_hmac_sha1(d,e)}return null};a._merge=function(e,f){if(e==undefined){e={}}if(f==undefined){f={}}for(var d in e){f[d]=e[d]}return f};return a}};