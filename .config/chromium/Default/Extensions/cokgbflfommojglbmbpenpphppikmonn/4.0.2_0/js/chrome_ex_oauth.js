function ChromeExOAuth(g,e,d,c,a,b,f){this.url_request_token=g;this.url_auth_token=e;this.url_access_token=d;this.consumer_key=c;this.consumer_secret=a;this.oauth_scope=b;this.app_name=f&&f.app_name||"ChromeExOAuth Library";this.key_token="oauth_token";this.key_token_secret="oauth_token_secret";this.callback_page=f&&f.callback_page||"chrome_ex_oauth.html";this.auth_params={};if(f&&f.auth_params){for(key in f.auth_params){if(f.auth_params.hasOwnProperty(key)){this.auth_params[key]=f.auth_params[key]}}}}ChromeExOAuth.initBackgroundPage=function(c){window.chromeExOAuthConfig=c;window.chromeExOAuth=ChromeExOAuth.fromConfig(c);window.chromeExOAuthRedirectStarted=false;window.chromeExOAuthRequestingAccess=false;var a=chrome.extension.getURL(window.chromeExOAuth.callback_page);var b={};chrome.tabs.onUpdated.addListener(function(e,d,f){if(d.url&&d.url.substr(0,a.length)===a&&d.url!=b[e]&&window.chromeExOAuthRequestingAccess==false){}});return window.chromeExOAuth};ChromeExOAuth.prototype.authorize=function(a){if(this.hasToken()){a(this.getToken(),this.getTokenSecret())}else{window.chromeExOAuthOnAuthorize=function(c,b){a(c,b)};chrome.tabs.create({url:chrome.extension.getURL(this.callback_page)})}};ChromeExOAuth.prototype.clearTokens=function(){delete localStorage[this.key_token+encodeURI(this.oauth_scope)];delete localStorage[this.key_token_secret+encodeURI(this.oauth_scope)]};ChromeExOAuth.prototype.hasToken=function(){return !!this.getToken()};ChromeExOAuth.prototype.sendSignedRequest=function(b,h,c){var g=c&&c.method||"GET";var a=c&&c.body||null;var f=c&&c.parameters||{};var e=c&&c.headers||{};var d=this.signURL(b,g,f);ChromeExOAuth.sendRequest(g,d,e,a,function(i){if(i.readyState==4){h(i.responseText,i)}})};ChromeExOAuth.prototype.signURL=function(c,f,h,e){var d=this.getToken();var b=this.getTokenSecret();if(!d||!b){throw new Error("No oauth token or token secret")}var g=e||{};var a=OAuthSimple().sign({action:f,method:h,path:c,parameters:g,signatures:{consumer_key:this.consumer_key,shared_secret:this.consumer_secret,oauth_secret:b,oauth_token:d}});return a.signed_url};ChromeExOAuth.prototype.getAuthorizationHeader=function(b,e,h,d,f){var c=this.getToken();var a=this.getTokenSecret();if(!c||!a){throw new Error("No oauth token or token secret")}var g=d||{};return OAuthSimple().getHeaderString({action:e,method:h,path:b,parameters:g,signatures:{consumer_key:this.consumer_key,shared_secret:this.consumer_secret,oauth_secret:a,oauth_token:c}},f)};ChromeExOAuth.fromConfig=function(a){return new ChromeExOAuth(a.request_url,a.authorize_url,a.access_url,a.consumer_key,a.consumer_secret,a.scope,{app_name:a.app_name,auth_params:a.auth_params})};ChromeExOAuth.initCallbackPage=function(){var c=chrome.extension.getBackgroundPage();var b=c.chromeExOAuthConfig;var a=ChromeExOAuth.fromConfig(b);c.chromeExOAuthRedirectStarted=true;a.initOAuthFlow(function(e,d){c.chromeExOAuthOnAuthorize(e,d);c.chromeExOAuthRedirectStarted=false;chrome.tabs.getSelected(null,function(f){chrome.tabs.remove(f.id)})})};ChromeExOAuth.sendRequest=function(g,b,d,a,f){var c=new XMLHttpRequest();c.onreadystatechange=function(h){f(c,h)};c.open(g,b,true);if(d){for(var e in d){if(d.hasOwnProperty(e)){c.setRequestHeader(e,d[e])}}}c.send(a)};ChromeExOAuth.formDecode=function(e){var h=e.split("&");var a={};for(var d=0,g;g=h[d];d++){var c=g.split("=");if(c.length==2){var b=ChromeExOAuth.fromRfc3986(c[0]);var f=ChromeExOAuth.fromRfc3986(c[1]);a[b]=f}}return a};ChromeExOAuth.getQueryStringParams=function(){var b=window.location.href.split("?");if(b.length>=2){var a=b.slice(1).join("?");return ChromeExOAuth.formDecode(a)}return{}};ChromeExOAuth.bind=function(b,c){var a=Array.prototype.slice.call(arguments).slice(2);return function(){var d=a.concat(Array.prototype.slice.call(arguments));b.apply(c,d)}};ChromeExOAuth.toRfc3986=function(a){return encodeURIComponent(a).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")};ChromeExOAuth.fromRfc3986=function(b){var a=b.replace(/%21/g,"!").replace(/%2A/g,"*").replace(/%27/g,"'").replace(/%28/g,"(").replace(/%29/g,")");return decodeURIComponent(a)};ChromeExOAuth.addURLParam=function(b,c,d){var a=(b.indexOf("?")>=0)?"&":"?";return b+a+ChromeExOAuth.toRfc3986(c)+"="+ChromeExOAuth.toRfc3986(d)};ChromeExOAuth.prototype.setToken=function(a){localStorage[this.key_token+encodeURI(this.oauth_scope)]=a};ChromeExOAuth.prototype.getToken=function(){return localStorage[this.key_token+encodeURI(this.oauth_scope)]};ChromeExOAuth.prototype.setTokenSecret=function(a){localStorage[this.key_token_secret+encodeURI(this.oauth_scope)]=a};ChromeExOAuth.prototype.getTokenSecret=function(){return localStorage[this.key_token_secret+encodeURI(this.oauth_scope)]};ChromeExOAuth.prototype.initOAuthFlow=function(e){if(!this.hasToken()){var d=ChromeExOAuth.getQueryStringParams();if(d.chromeexoauthcallback=="true"){var a=d.oauth_token;var c=d.oauth_verifier;this.getAccessToken(a,c,e)}else{var b={url_callback_param:"chromeexoauthcallback"};this.getRequestToken(function(f){window.location.href=f},b)}}else{e(this.getToken(),this.getTokenSecret())}};ChromeExOAuth.prototype.getRequestToken=function(g,e){if(typeof g!=="function"){throw new Error("Specified callback must be a function.")}var b=e&&e.url_callback||window&&window.top&&window.top.location&&window.top.location.href;var f=e&&e.url_callback_param||"chromeexoauthcallback";var c=ChromeExOAuth.addURLParam(b,f,"true");var a=OAuthSimple().sign({path:this.url_request_token,parameters:{xoauth_displayname:this.app_name,scope:this.oauth_scope,oauth_callback:c},signatures:{consumer_key:this.consumer_key,shared_secret:this.consumer_secret}});var d=ChromeExOAuth.bind(this.onRequestToken,this,g);ChromeExOAuth.sendRequest("GET",a.signed_url,null,null,d)};ChromeExOAuth.prototype.onRequestToken=function(f,e){if(e.readyState==4){if(e.status==200){var d=ChromeExOAuth.formDecode(e.responseText);var c=d.oauth_token;this.setTokenSecret(d.oauth_token_secret);var a=ChromeExOAuth.addURLParam(this.url_auth_token,"oauth_token",c);for(var b in this.auth_params){if(this.auth_params.hasOwnProperty(b)){a=ChromeExOAuth.addURLParam(a,b,this.auth_params[b])}}f(a)}else{throw new Error("Fetching request token failed. Status "+e.status)}}};ChromeExOAuth.prototype.getAccessToken=function(b,c,f){if(typeof f!=="function"){throw new Error("Specified callback must be a function.")}var d=chrome.extension.getBackgroundPage();if(d.chromeExOAuthRequestingAccess==false){d.chromeExOAuthRequestingAccess=true;var a=OAuthSimple().sign({path:this.url_access_token,parameters:{oauth_token:b,oauth_verifier:c},signatures:{consumer_key:this.consumer_key,shared_secret:this.consumer_secret,oauth_secret:this.getTokenSecret(this.oauth_scope)}});var e=ChromeExOAuth.bind(this.onAccessToken,this,f);ChromeExOAuth.sendRequest("GET",a.signed_url,null,null,e)}};ChromeExOAuth.prototype.onAccessToken=function(f,e){if(e.readyState==4){var c=chrome.extension.getBackgroundPage();if(e.status==200){var d=ChromeExOAuth.formDecode(e.responseText);var b=d.oauth_token;var a=d.oauth_token_secret;this.setToken(b);this.setTokenSecret(a);c.chromeExOAuthRequestingAccess=false;f(b,a)}else{c.chromeExOAuthRequestingAccess=false;throw new Error("Fetching access token failed with status "+e.status)}}};